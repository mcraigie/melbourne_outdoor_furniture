<p id="notice"><%= notice %></p>

<h1>Pieces</h1>

<%= render 'search_form' %>

<br>

<% if @pieces.blank? %>
  <h4>There are no pieces matching your search</h4>
<% else %>
  <table>
    <thead>
      <tr>
        <% piece_fields.each do |_, f| %>
          <td>
          <% sorting_by_field = params[:sort_by] == f[:query_string]%>
          <% indicator = sorting_by_field ? "  #{sort_arrow(params[:sort_dir])}": ''%>
            <%=
              link_to "#{f[:title]}#{indicator}",
              request.query_parameters.merge({
                :sort_by => f[:query_string],
                :sort_dir => (sorting_by_field ? invert(params[:sort_dir]) : 'ASC')
              })
            %>
          </td>
        <% end %>
      </tr>
    </thead>

    <tbody>
      <% @pieces.each do |piece| %>
        <%= render 'search_result', piece: piece %>
      <% end %>
    </tbody>
  </table>
<% end %>
